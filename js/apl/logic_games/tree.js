// Game propriety
const MIN_WIDTH = 5;
const MAX_WIDTH = 8;
const DEFAULT_INP_VALUE = 1;
const DEFAULT_OUT_VALUE = 0;

// Request body
const state = 'c-pm@349Y(9>?FLS6T?I&;lAZohFpCDz*qE0;UD5gbG5SBS%Z7=`<}(JLyc)(t@ZQuIpYZt9!7A9Io!_>MrZ*o{EYm-WQ6nc;S8Hec|s--gMh(hUvl1=kx8$ym|NgzyI-ic$b~@d{S9z8(uJ+rZ?~D^+|g&So+NQJ?rc3r7a^#pJVJ%*!wWOoeO%_H+ISqa#^CjA>W?J|CaR1e}JYPCi!bk^4o|+LUjCkerY0KB{GR<UzMcw65o60E2yC+$&aFZviug4aWxZ>#FFMGFW+R$XY;5xDPO1Wn;}1hUKMR-hVP~NcRE8lHd$Mlbkpw=S*rb(lJ*~B>)N}0edcEUH)uQ7WHNq{^-oOZEn?<ty2;y6mL4q+&ZVh?z3*UYie7&Yv32h+zkr<^_I`0c%kSx3o*b{d&!oIQzifBU@@8^oRi9YMqt$+x$-R}F<*;;vE>X%^_)`WJfGQBwPAehnNjU0lRn)p@SRLg}74Vkhi;uMV)NnK>@v}?~6S9uT@w{|=9_0;YREa@5$gC2J{8=f!R(xNXCU=`}*Se2Sq`F+!b%+rer57FAs|nQzy}Xa`-RG;XtIeP<NgvNyf6JMzv(^5YJ!bknpQZB_C$=b?y~j!a9$QayV)<kn_Cx5hCp~+{?qe`cd2)%{XPe^W$YQ75T2SFGw+S|`k|X6VStXT$VDUtElUNYri_@z3R_`PaKF7RVWeTYzWSZ-Ll90*L+J2r-Vxecv?3dMf<Sg{PmHr&)GuU=@y&7P8Ro~CM2e}?8gV&q3WbI~}v^&%whhFy1&#&i2J|smVe51-s&Cys#5wA$mh!~Ri#u(q;7;E5T4H6#_m9V77_!dc2wDQUO8KU<yA(5V}_d^0$b!ydO_#M-<EzkBsA&u~Bc+!rPe&LDgS=&!NZ!DK#n6Iwy__bbsVZ6CkQg|6NS0qtQTHkJ{@6zkfL6w+<HH*rs+E^Qr_@#;@@zHo^XGAjh*9Pie=+b(M(XO<X;?HbA#d2PkO(CeJ*_Ci^4M}l?r`C{EM;JMZ!UsKySRM2%<BODWyci%va>{8?NHs2bsNGqSlj-!N`W3E*q&vb}YDk7dQ%ZZCGFNE}a+P^$f|$yYolZI3$5s0Lc7e~V;>cE)T#+TX%d&(5pDoLoCb<1+LIH3i;h>f_x#V@OsL8oBvs2Z~PB{#A%4XQ_j6T{4vwb;Hb|n0Nwj;v~>ovd2j)Z&LkuYq>5{}GA67VYd)PBr@{ou%Qr<^Jj#alVD$R!6_VK}%-zDctj9zw=<YsY9mtm29R=>H!2a<J#a%D+Ex_M?C8>UvjY_QT2EH*%y;dPhI^{9Gv_LGMt_tMZL4yec+Jn*QpW{u^y*N0HlAUTmr3LvkeE+@f05A8DvB)~$hsXo)2TbR0Wouy@CpB%HAL!VoX$arOZ0WYThJR{b0F7awYnLQU53MPJX0mH%RFC(|&l30-!Jj*D-sr^Z~-B!?Gcd<6CnHl44hHjHj%-{bnh#bF&5_ZXIOc0c1}%X<`ydj|bJ<TRH5XqO$PG2JC#3%C~C2<`%pQ?CKr=m#*9qye;Wnr*IA>tc2By0*IZaC^e-4;Gh92$be8w+qAkT%|aDDm9$dE}6a;bfnsaJOwqI!h~xka%XOSn|D>vF61g=PJ3PlEcOsbxXoMGR@=Egzb%B49J#|OJA`VkGN5o|H%xRJa-%+f+lGoL%4a*ms+Z$N!X6-aD9QE(hvf)Ge$PpQ=qngrRa#gvg8s>^DxEtyw`x*Fv0W&z3vT>{*?0RLLLN0L`_V3KEzc2-qqTC(Bajjp5$w#h`NYz>*+|R8L|Lwol^y8_$GpWIdF}W;ih3BR5{%{8h0;7xR5Ri*XP0-2Xs!GN=}5v)7-R4gGEDr0zCLF1N-X5o?0d*yEv)3YulGJ?ayn4I#~APEe#dUoH+#kF`lc)zjdbw!JvC03no$QDHxY|-Yc)RIf785nm5(A0fGI3uW>B+;no+eHhkcN7ua#aM=sm9PkIwGWPt*d?SfQ201*$hyu%!tj@|mX}#d}@}AuF76iRQt#S0udqq6(^n=D6gJV7jkB5d%SJ0p5@GLB%Xb|NQv_2M6cR>+>TP>t^+s`Stp}-Kg}Q=b&pp^AhQ{$=fg8wmE&4m0X(be|GNi^Rr0b<X$gtmY-rV-!#K~jqT)*@7ubi8`{zLbF<z~F6lX8c6PFuEbwft(^(%*=EF=wJko^53P~a^>BM^+tk!g3A}$HBdnt*Xe;NrjfJU%}-7Q6!Y|!&2Yxj%vBoOTsQ9T)BcYri{ZfE+D>iSMLWICT)nB9+{|0zh%0L1`@hD-%#((!`n?4-?L>%RkgcOBBPU?;naPj@G7gUi93ZqfTWpaPuBVmm*(F~$ib=YfS_5unSz7%ZVW8Y~6N*v&G%TcrPvS`JpQy`=m64Y(a#M8A0w-U+?Gx(D2^-53z^5ZDJE29Id|4Iz&)FXl<`6nL8MKX@J-055<;On1Km-T@zgkH9B{-dq!M6E^rlI)BW2I{LnW`Sg3iz2H8&XUKmL=@Z~t@EkY@4ucoLOW<YjDmVgO1FwTOz?<ML@HTiCya(O~AA*(ObZ|D>Uq$cGkj|tsgR#t_a^p_ipahXl0OP@_c%KYD1N&)RDyztkdFb5>Ay*<k*$Py=?}KnoqVkO2Ss(-DM!OR}_eP|fz(g>K$^qErPTbJY{|FROIYb==ECCC^d@u`KgL12p&HywVT84BXJr7_F5b?bh9L2Yf!KdJJKvji@-BpbPx6-%|W6S|VK`xj{4-^;!#)7G!2-pe}cZ^?vFTq!!27Jx_W8p#Lx3PP}c64$l((QB~k$(jSc@?Ne{zT+eGdoMY;p@TG$gcq*PvR_ekK4NR!sH_F%2nwZT&688#s2)4sSodeZr0EPj(>c9>mTmE;j~{*Iit8_>Y3A~m(KX$u4{Mfy6N?@@;P(ool|k{eE)*V^A;{TfANyQ(q&b`1<O}#`|THR=e&E;@DaIrBS(!s`4s1v@452%0=H*u;kfY=CQe$n=fYc7e|7Zi*)zYs_|zBPuleW_u{N}E)8;zq()w^i<C><(_nTYf=w&zlpjA;XkNxmRKmJMEPp`Q0s;xh}`kMBi|KgWxf7S8S)1A-!@!2=teCwU+_>lFV{Q1+r_-_Bx-`~6b_y7LSbx%CGedj;__25|>?!4pUzulH~(Y^<M^Sk@+d-UE%f}ef+(6KF#KX&>(dw1WQ{o$~0UV81nhYlZn`IRHDzW7&NA7{IIsY@zhQ;hn3i>-hD>~}QNG<p';
const size = 7986;
const hash = '*Z0rXuwzRg)sQAY?=tI6q$kr2N5-a{hLF>WD^vLLRSK1EOEajar{nE3$T!y-8_-=vu@@ZKb-`2jIUxkR';

function getInputMatrix() {
  return Array.from(document.querySelectorAll('.input__table tr')).map(
    item => Array.from(item.querySelectorAll('input')).map(
      x => +x.value || DEFAULT_INP_VALUE
    )
  )
}

document.querySelector('.btns__solve').addEventListener('click', async () => {
  let input = getInputMatrix();

  let solution = await evaluateAPL(`solver (↑⍣≡0∘⎕JSON) '${JSON.stringify(input)}'`);
  if (solution.length) {
    let input = solution.map(item =>
      item.split` `.map(x => +x || DEFAULT_OUT_VALUE)
    );
    session_style(2);
    makeOutputTable(input);
  }
});

document.querySelector('.btns__create').addEventListener('click', async () => {
  // !Check if there's only one possible solution
  // *Add an alert if there are changes in tableInp & tableTry
  let result = await evaluateAPL(`creator ${document.querySelector('.dimension__value').value || MIN_WIDTH}`);
  if (result.length) {
    session_style(1);
    makeInputTable2(result.map(item =>
      item.split` `.map(x => +x || DEFAULT_OUT_VALUE)
    ));
  }
});

document.querySelector('.btns__try').addEventListener('click', async () => {
  let input = getInputMatrix();
  let try_label = document.querySelector('.try__label');

  let solution = await evaluateAPL(`solver (↑⍣≡0∘⎕JSON) '${JSON.stringify(input)}'`);
  if (solution.length) {
    session_style(3);
    try_label.innerText = 'Solve';
    try_label.style.color = '#4169e1';
    makeTryTable(input);
  }
});

document.querySelector('.btns__verify').addEventListener('click', async () => {
  let input = getInputMatrix();

  let try_matrix = Array.from(document.querySelectorAll('.try__table tr'))
    .map(item =>
      Array.from(item.querySelectorAll('.try__table input'))
        .map(x => +x.value || DEFAULT_OUT_VALUE)
    )

  let result = await evaluateAPL(`solver (↑⍣≡0∘⎕JSON) '${JSON.stringify(input)}'`);
  let solution = result.map(item => item.split` `.map(x => +x))

  let try_label = document.querySelector('.try__label');

  if ((JSON.stringify(solution) === JSON.stringify(try_matrix))) {
    try_label.innerText = 'Correct!';
    try_label.style.color = '#008000';
    document.querySelectorAll('.try__table input').forEach(elem => elem.readOnly = 'true');
  } else {
    try_label.innerText = 'Wrong!';
    try_label.style.color = '#e62020';
  }

  document.querySelectorAll('.try__table input').forEach((e) => {
    e.addEventListener('click', () => {
      try_label.innerText = 'Try again!';
      try_label.style.color = '#4169e1';
    })
  })
});