// Game propriety
const MIN_WIDTH = 5;
const MAX_WIDTH = 11;
const DEFAULT_INP_VALUE = '';
const DEFAULT_OUT_VALUE = 1;

// Request body
const state = 'c-p;}2Y6Fe6vyvNn-oIRv_PdANMBkiEk&RymJmTI7AheOTiZBF$;;>?kmi;5lC~g<N^uVmH!cwO-dl0uz^y2#2<|;_Z~WinzJBzzX`+6g@B4l^@2>OiIQN{Bof`*`o=+x|y1}-=RNk_wS5y4SVsh)ep5s-0`UcYHvxhx0E9a<sj_f&J`%#XNQxoGg^#c<1f017G&rrFH^xeNxou^vwNc2~TM8c$<1c}_IJ{c{_-s4z(8(Ko7m9_S6j}RX;%e~jd+FOY|Nqt3<`o8suz1J0Aub(W$-27y5l5xHy`*einJhGWorg>}jKEFGd%uvT~>Z#9M)P0Wqo?ohc)9P34rEpY2j$mb82#0xJSnw}a_|}*b<$XckFGV6je>52ALy!91LL0Mx&AL;qD_OrR&HVD!`9&n&-dT~DA|F!1LL{K{v;S$>Z(8T9-iJIUn~5RuvV_{71I%GxJ&}lQ&Lwg{5%Zf#rU?bTCtp`>^U77OB15BKHZ)er;@oDEg|=KLA<Hci=eBZgN9R&&z0ot@Yp-nL+(NzH!@GE#V3Spn3-q3z`=!_H51S1MEEU2MjCt*h%>pgws{N}8zxO_8X#5dL(~gtv3rVrx$sX;!*q4=k+<!YKtvwCY>{qF3Pi?U%GbU>J{$Mz)@KOt^Bvb`E{lT^<FGYf>^p&Xk=1EE@8j>PZi5zST3b;3XB-ZK+$_g*aQmn1dd!)S=x+LpR&$*EGGplhYL!ULsls9D9h{BSx@^QV!Woza;S)Ff9sHG(+2P4rCX4-qkp$IQa9SUFCT2aR1uE80EW33UC?PclsmEqm{f_<*wqY~Xrg%<*g1V26+-|%$&#GWMkq1Wt3xBuDm&;07Y^;60GUv(0{{C~$gG5xsJBR>Ay_<kU(|GL{hdhtVD(FSl8xSmD5r@`ys1Mnf3h@)_T25=3>d}tsVhy~gM9f3|!?0~Pl)FKggCg(PL2R4>)Zky2~n7xBMcrA**W;d1?JvMkxv&n<EBF;_7LaW3zlN^&Mu4pD^li2CZZ5-(;l*OpC(r&KFw~uz!7CWFN!&NAVF=uCHgUM4bXGUeQofZbsLRqv-7DdHbX{**5Erc6uk-QjU%kvae*9#7g%b{M}SIW8l9H+BNdF2+n*V|<D6kswFT@HJxAQ(M4E*qWEZmU!qYsaJpo2X90&8CALIkom$G;>qYtmHJ4AvAapZlguYtn8}exC<>(SG`lmEu+1wU8~Sp$F*7|TbH9o$E~(V2p*ifo}hLm*6ilEAT)9Ax-O?(CLH33l6L%9&f-U*CVmV^5kJy>Qr!!ZW?qx(o+NLt=(k-=q2HIHUDm85**#13B>TUh#`R%_p8mbtZ?S}FUHSTx*L4}DB=cvf@=Wv4{_BmTe}Ad%pR7J3#d`Ic^=kE~cARS83>rPEzwT1?3?)4m%xs>n(?sJK+iL^+hK1z<RmFrX)+O=)I+bN8$G`&S{e1D<1@{XCK?}37g&+hL0h-f<nQcUX6u%d6p>ca6aeIn_7-$C_EWcXH@*a+@=T<P5>caQOLsCnpx1kbDU_QEvdR&&dPGbAN0cUqL<VfbJsmC^;?hwdn;7~x5wCP|5s0D|CnZN~R0eCkun`Ogu0p0$?K^>@P`6T^|+X!e%OaHze1&(HCNzeIDa4%Rv+pvbmARh-$u&6;V&~so5cpkg}UIZ_Jm%*#xH5OgAg6-ff@HW`N{xi|2^CkEed<T96$AX)1z{k<`W8D++?d$MPL;aKBDX^KI8S0;fd<DD#wt;uRPOuBS2i|8<?IZ9p_yl|kJ_DbFFThvvI7!GiU^h4hj001lzlr7$#fdyEfVoVeb_01Zq!+Rji~<LsTn>H)Z_=^UR#6|t*yHiO26@R^prE`3#yOhWGv19L3;ha;61nh6kSjqM7)|W}Yy`{Eb`Tgt?GR&RPzPp#nP3XI0R0v~P69LyYJi+W?*mu_1ho6W_h|b8`~-dh)K#FFSi%0_E>M6u=7MZ66ihBjB-g{iNH7760lJbzj`b_}4g4PePe#ZebbqK`D8C2NN$&|h@+jnbdXA`HjY*yh=A)h_vGZA+yAoUr&PRPS@E0fU!ru91w_hk9<2<Ixki`wu=`#jw|1I<RH@8j6e#><KFLz!4_;q719baLuoN!>(M8~9WAG>nH#+yDlWZI!M(`VEkHq$lBJ$ugFd5724AJNe0Ir6BZ*IoYW7r9^M4IVNyf1hCm`|f8MKEhha+lq=umh3;Ov~2XTn~uA6!SCNsJ$UjTCmithH_hLjDERy*t?UW}Pi_$xh88UjpVAtU+D^Ukv?a1~di0Dl&pNyPoYia2U3=d77j#^B(Z!vYEPd_uWm|7}<I~SR|8jn8(DEN|`|0-TdvCt)>uaxh=;5nhd3F6&4?OtnLB~J($PahlV_dQ2nai$tdh?4<z2N=%ujlrxdikYsPds_YE#}=hf4=weyE}Hi^Zo}PeYopR)gPO!z1$_Wu<=^|zDoDc@`Jwt<$OjN';
const size = 4962;
const hash = '6);$?p2m_N*v5indMSWWKeo{UVXdp2oQf<4cOR~FEFCV8l{fOfu?kY*+=X{R25R0(HkWBXEgTfgv#-l_';

function getInpMatrix() {
  return Array.from(document.querySelectorAll('.tableInp tr')).map(
    item => Array.from(item.querySelectorAll('.inp')).map(
      x => +x.value || DEFAULT_INP_VALUE
    )
  )
}

async function trySolve() {
  let matrix = getInpMatrix();

  let solution = await evaluateAPL(`solver (↑⍣≡0∘⎕JSON) '${JSON.stringify(matrix)}'`);
  if (solution.length) {
    session_style(3);
    document.querySelector(".tryLabel").innerText = "Solve";
    makeTryTable('number', matrix);
  } else { // ?Useful
    session_style(1);
    alert("This puzzle hasn't got an answer...");
  }
}

async function solve() {
  let matrix = getInpMatrix();

  let solution = await evaluateAPL(`solver (↑⍣≡0∘⎕JSON) '${JSON.stringify(matrix)}'`);
  if (solution.length) {
    let input = solution.map(item =>
      item.split` `.map(x => +x || DEFAULT_OUT_VALUE)
    );
    session_style(2);
    makeOutTable(input);
  } else { // ?Useful
    session_style(1);
    alert("This puzzle hasn't got an answer...");
  }
}

async function create() {
  // !Check if there's only one possible solution
  // *Add an alert if there are changes in tableInp & tableTry
  let result = await evaluateAPL(`creator ${document.querySelector('.dimInput').value || MIN_WIDTH}`);
  if (result.length) {
    let input = result.map(item =>
      item.split` `.map(x => +x || DEFAULT_OUT_VALUE)
    );
    session_style(1);
    makeInpTable2(input);
  } else { // ?Usefull
    session_style(1);
    alert("This puzzle hasn't got an answer...");
  }
}

async function verify() {
  let matrix = getInpMatrix();

  let try_matrix = Array.from(document.querySelectorAll('.tableTry tr'))
    .map(item =>
      Array.from(item.querySelectorAll('.try'))
        .map(x => +x.value || DEFAULT_OUT_VALUE)
    )

  let result = await evaluateAPL(`solver (↑⍣≡0∘⎕JSON) '${JSON.stringify(matrix)}'`);
  let solution = result.map(item => item.split` `.map(x => +x))

  if (JSON.stringify(solution) === JSON.stringify(try_matrix)) document.querySelector(".tryLabel").innerText = "Correct!";
  else document.querySelector(".tryLabel").innerText = "Wrong!";
}